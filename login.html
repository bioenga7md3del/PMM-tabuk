<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PPM TABUK - Login</title>
<style>
  body{
    margin:0; height:100vh; display:flex; align-items:center; justify-content:center;
    background:#0b1220; color:#fff; font-family:system-ui,Segoe UI,Roboto,Arial;
  }
  .login-box{
    background:#111827; border-radius:12px; padding:30px; width:100%; max-width:420px;
    box-shadow:0 8px 24px rgba(0,0,0,.4); text-align:center;
  }
  .logos{display:flex; align-items:center; justify-content:center; gap:20px; margin-bottom:20px;}
  .logos img{height:60px; object-fit:contain;}
  h1{font-size:20px; margin:10px 0; color:#10b981}
  h2{font-size:14px; margin:0 0 20px; color:#9ca3af}
  input{
    width:100%; padding:12px; margin:8px 0; border-radius:8px;
    border:1px solid #374151; background:#0b1220; color:#fff;
  }
  input::placeholder{color:#6b7280}
  .btn{
    width:100%; padding:12px; margin-top:12px; border:0; border-radius:8px;
    cursor:pointer; font-weight:700;
  }
  .btn.login{background:#10b981; color:#083344}
  .btn.new{background:#3b82f6; color:#e0f2fe}
  .note{margin-top:16px; font-size:12px; color:#9ca3af}
</style>
</head>
<body>
  <div class="login-box">
    <div class="logos">
      <img src="assets/FGC.jpeg" alt="FGC"/>
      <img src="assets/TabukCluster.jpeg" alt="Tabuk"/>
    </div>
    <h1>Welcome to PPM TABUK</h1>
    <h2>إدارة الصيانة – قسم الأجهزة الطبية</h2>

    <input id="email" type="email" placeholder="البريد الإلكتروني"/>
    <input id="password" type="password" placeholder="كلمة المرور"/>
    <button class="btn login" onclick="login()">تسجيل الدخول</button>
    <button class="btn new" onclick="register()">مستخدم جديد</button>
    <div id="msg" class="note"></div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyDegk1oK0xV8TgrZcwbkRLA2VgzkGK_1MM",
  authDomain:"pmqrtabuk.firebaseapp.com",
  projectId:"pmqrtabuk",
  storageBucket:"pmqrtabuk.firebasestorage.app",
  messagingSenderId:"305570616285",
  appId:"1:305570616285:web:4f6839fd08b8b5aa131c34"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const $ = id=>document.getElementById(id);
function showMsg(msg){ $('msg').textContent = msg; }

window.login = async function(){
  try{
    const email=$('email').value.trim();
    const pass=$('password').value.trim();
    await signInWithEmailAndPassword(auth,email,pass);
    showMsg("✅ تم تسجيل الدخول بنجاح");
    setTimeout(()=>location.href="index.html",1000);
  }catch(e){ showMsg("❌ خطأ: "+e.message); }
};

window.register = async function(){
  try{
    const email=$('email').value.trim();
    const pass=$('password').value.trim();
    const cred=await createUserWithEmailAndPassword(auth,email,pass);
    await setDoc(doc(db,"users",cred.user.uid),{
      email, role:"technician", createdAt:new Date().toISOString()
    });
    showMsg("✅ تم تسجيل المستخدم في Authentication + Firestore");
  }catch(e){ showMsg("❌ خطأ: "+e.message); }
};
</script>
</body>
</html>
